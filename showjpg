#!/bin/sh

export LANG=c

image=$1
LOGS_DIR=$2

if [ "$LOGS_DIR" != "" ] && [ -d $LOGS_DIR ]]; then
	log=$LOGS_DIR/fbv.log
else
	log=/dev/null
fi

if [ -e "x$some_variable" ]; then
	cat /dev/zero > /dev/fb0 2>/dev/null;
	/usr/local/bin/fbv -quickfe $image 2>&1 >> $log
else
	# perhaps we want to cycle through different backgrounds?
	background=background.jpg
	logo=logo.png
	if [ -e $background ]; then
		bg_cmd_1="\\( mpr:img -fuzz 45% -transparent \#00ff00 +write mpr:img \\)"
		bg_cmd_2="\\( ${background} mpr:img -gravity center -composite +write mpr:img \\)"
	fi
	if [ -e $logo ]; then
		logo_cmd="\\( mpr:img $logo -gravity southeast -composite +write mpr:img \\)"
	fi
	cmd="convert ${image} -write mpr:img +delete \
		-respect-parentheses \
		$bg_cmd_1 \
		$bg_cmd_2 \
		$logo_cmd \
		\( mpr:img +write ${image}.out.jpg \) \
		\)"
	eval $cmd

	# gThumg needs to be configured to enable Preferences->"Reuse the active window to open files"
	gthumb ${image}.out.jpg &
fi
